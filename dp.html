<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Departamento Pessoal — Indicadores Mensais</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
      color: #6ee7ff;
      text-shadow: 0 0 10px rgba(110,231,255,0.5);
      text-align: center;
      font-family: 'Space Mono', monospace;
      font-weight: 700;
    }
    .chart-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(340px, 1fr));
      gap: 24px;
      width: 95%;
      margin-top: 30px;
    }
    @media (max-width: 900px){
      .chart-grid{ grid-template-columns: 1fr; }
    }
    .chart-box {
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      padding: 18px;
      height: 320px;
    }
    .chart-box.full { grid-column: 1 / -1; height: 360px; }
    .chart-title { margin: 0 0 10px; font-weight: 600; color: #d6e6ff; }
    
    /* --- Estilos para os Novos Filtros --- */
    .filter-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      width: 95%;
      margin: 20px auto 10px;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      justify-content: center;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .filter-group label {
      color: #d6e6ff;
      font-weight: 600;
      font-size: 14px;
      margin-left: 5px;
    }
    .filter-group select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(110,231,255,0.3);
      background: #2c5364;
      color: #e0e0e0;
      font-size: 16px;
      cursor: pointer;
    }
    .filter-group select:focus {
      outline: none;
      box-shadow: 0 0 10px rgba(110,231,255,0.5);
    }
    /* --- Fim dos Estilos de Filtro --- */

    table {
      width: 95%;
      border-collapse: collapse;
      margin: 10px auto 48px; /* Margem superior reduzida */
      background: rgba(255,255,255,0.05);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      border-radius: 12px;
      overflow: hidden;
    }
    th, td { padding: 10px 14px; text-align: center; }
    th { background: rgba(139,92,246,0.3); color: #fff; text-transform: uppercase; letter-spacing: 1px; }
    tr:nth-child(even){ background: rgba(255,255,255,0.03); }
    tr:hover{ background: rgba(110,231,255,0.1); }
    td{ color:#d0e0ff; }
    a.voltar{ display:inline-block; margin:20px; padding:10px 16px; border-radius:10px; background:rgba(139,92,246,0.3); color:#fff; text-decoration:none; }
    a.voltar:hover{ background:rgba(139,92,246,0.5); }
  </style>
</head>
<body>
  <h1>Departamento Pessoal — Indicadores Mensais</h1>
  <a href="index.html" class="voltar">← Voltar para Home</a>

  <div class="chart-grid">
    <div class="chart-box">
      <h3 class="chart-title">Admissões</h3>
      <canvas id="chartAdmissoes"></canvas>
    </div>
    <div class="chart-box">
      <h3 class="chart-title">Demissões</h3>
      <canvas id="chartDemissoes"></canvas>
    </div>
    <div class="chart-box">
      <h3 class="chart-title">Férias</h3>
      <canvas id="chartFerias"></canvas>
    </div>
    <div class="chart-box">
      <h3 class="chart-title">Pró Labores</h3>
      <canvas id="chartProLabores"></canvas>
    </div>
    <div class="chart-box full">
      <h3 class="chart-title">Folhas de Pagamento</h3>
      <canvas id="chartFolhas"></canvas>
    </div>
  </div>

  <div class="filter-container">
    <div class="filter-group">
      <label for="selectMes">Filtrar por Mês:</label>
      <select id="selectMes">
        <option value="todos">Todos os Meses</option>
        <option value="06 - JUNHO">Junho</option>
        <option value="07 - JULHO">Julho</option>
        <option value="08 - AGOSTO">Agosto</option>
        <option value="09 - SETEMBRO">Setembro</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="selectTipo">Filtrar por Tipo:</label>
      <select id="selectTipo">
        <option value="todos">Todos os Tipos</option>
        <option value="Admissões">Admissões</option>
        <option value="Demissões">Demissões</option>
        <option value="Férias">Férias</option>
        <option value="Pró Labores">Pró Labores</option>
        <option value="Folhas de Pagamento">Folhas de Pagamento</option>
      </select>
    </div>
  </div>
  <table>
    <thead>
      <tr>
        <th>Departamento Pessoal</th>
        <th>Mês</th>
        <th>Quantidade</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr data-dept="Admissões"><td>Admissões</td><td>06 - JUNHO</td><td>79</td></tr>
      <tr data-dept="Admissões"><td>Admissões</td><td>07 - JULHO</td><td>117</td></tr>
      <tr data-dept="Admissões"><td>Admissões</td><td>08 - AGOSTO</td><td>127</td></tr>
      <tr data-dept="Admissões"><td>Admissões</td><td>09 - SETEMBRO</td><td>102</td></tr>

      <tr data-dept="Demissões"><td>Demissões</td><td>06 - JUNHO</td><td>107</td></tr>
      <tr data-dept="Demissões"><td>Demissões</td><td>07 - JULHO</td><td>106</td></tr>
      <tr data-dept="Demissões"><td>Demissões</td><td>08 - AGOSTO</td><td>119</td></tr>
      <tr data-dept="Demissões"><td>Demissões</td><td>09 - SETEMBRO</td><td>92</td></tr>

      <tr data-dept="Férias"><td>Férias</td><td>06 - JUNHO</td><td>34</td></tr>
      <tr data-dept="Férias"><td>Férias</td><td>07 - JULHO</td><td>46</td></tr>
      <tr data-dept="Férias"><td>Férias</td><td>08 - AGOSTO</td><td>20</td></tr>
      <tr data-dept="Férias"><td>Férias</td><td>09 - SETEMBRO</td><td>24</td></tr>

      <tr data-dept="Pró Labores"><td>Pró Labores</td><td>06 - JUNHO</td><td>275</td></tr>
      <tr data-dept="Pró Labores"><td>Pró Labores</td><td>07 - JULHO</td><td>274</td></tr>
      <tr data-dept="Pró Labores"><td>Pró Labores</td><td>08 - AGOSTO</td><td>272</td></tr>
      <tr data-dept="Pró Labores"><td>Pró Labores</td><td>09 - SETEMBRO</td><td>271</td></tr>

      <tr data-dept="Folhas de Pagamento"><td>Folhas de Pagamento</td><td>06 - JUNHO</td><td>1564</td></tr>
      <tr data-dept="Folhas de Pagamento"><td>Folhas de Pagamento</td><td>07 - JULHO</td><td>1576</td></tr>
      <tr data-dept="Folhas de Pagamento"><td>Folhas de Pagamento</td><td>08 - AGOSTO</td><td>1706</td></tr>
      <tr data-dept="Folhas de Pagamento"><td>Folhas de Pagamento</td><td>09 - SETEMBRO</td><td>1562</td></tr>
    </tbody>
  </table>

  <script>
    const MESES = ['06 - JUNHO','07 - JULHO','08 - AGOSTO','09 - SETEMBRO'];
    let filtroAtivo = null;

    const series = {
      'Admissões':       { cor: 'rgba(59,130,246,0.9)', valores: [79, 117, 127, 102] },
      'Demissões':       { cor: 'rgba(239,68,68,0.9)', valores: [107, 106, 119, 92] },
      'Férias':          { cor: 'rgba(34,197,94,0.9)', valores: [34, 46, 20, 24] },
      'Pró Labores':     { cor: 'rgba(234,179,8,0.9)', valores: [275, 274, 272, 271] },
      'Folhas de Pagamento': { cor: 'rgba(139,92,246,0.9)', valores: [1564, 1576, 1706, 1562] }
    };

    // ========= Função de Filtro da Tabela Modificada =========
    // Esta função agora é o controlador central para todos os filtros
    function updateTableFilters() {
      const selectedMes = document.getElementById('selectMes').value;
      const selectedTipo = document.getElementById('selectTipo').value;
      const rows = document.querySelectorAll('#tableBody tr');
      const h1 = document.querySelector('h1');

      rows.forEach(row => {
        const rowDept = row.dataset.dept;
        const rowMes = row.cells[1].textContent;

        const mesMatch = (selectedMes === 'todos' || rowMes === selectedMes);
        const deptMatch = (selectedTipo === 'todos' || rowDept === selectedTipo);

        // Mostra ou esconde a linha baseado na combinação dos filtros
        row.style.display = (mesMatch && deptMatch) ? '' : 'none';
      });

      // Atualiza o H1 e o filtroAtivo baseado no dropdown de Tipo
      if (selectedTipo !== 'todos') {
        h1.textContent = `Departamento Pessoal — ${selectedTipo}`;
        filtroAtivo = selectedTipo;
      } else {
        h1.textContent = 'Departamento Pessoal — Indicadores Mensais';
        filtroAtivo = null;
      }
    }

    // ========= Função de clique no gráfico (simplificada) =========
    // Agora ela apenas atualiza o dropdown de "Tipo" e chama a função principal de filtro
    function filtrarTabela(departamento) {
      const selectTipo = document.getElementById('selectTipo');
      
      if (filtroAtivo === departamento) {
        // Remove filtro se clicar no mesmo departamento
        selectTipo.value = 'todos';
      } else {
        // Aplica filtro
        selectTipo.value = departamento;
      }
      // Dispara a atualização da tabela e do H1
      updateTableFilters();
    }

    function criarGraficoLinha(canvasId, label, serie){
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: MESES,
          datasets: [{
            label: label,
            data: serie.valores,
            borderColor: serie.cor,
            backgroundColor: serie.cor.replace('0.9', '0.3'),
            borderWidth: 2.5,
            tension: 0.3,
            fill: true,
            pointRadius: 5,
            pointHoverRadius: 7,
            pointBackgroundColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          onClick: (event, elements) => {
            // Ao clicar no gráfico, filtra a tabela
            filtrarTabela(label); // Não precisa mais do 'if (elements.length > 0)'
          },
          scales: {
            y: { beginAtZero: true, ticks: { color:'#e0e0e0' }, grid: { color:'rgba(255,255,255,0.1)' } },
            x: { ticks: { color:'#e0e0e0' }, grid: { color:'rgba(255,255,255,0.05)' } }
          },
          plugins: {
            legend: { labels: { color:'#e0e0e0' } },
            tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y } }
          }
        },
        plugins: [{
          id: 'datalabels',
          // ========= Plugin de Datalabels Modificado =========
          afterDatasetsDraw(chart) {
            const { ctx: canvasCtx, data } = chart;
            
            data.datasets.forEach((dataset, datasetIndex) => {
              const meta = chart.getDatasetMeta(datasetIndex);
              meta.data.forEach((point, index) => {
                const value = dataset.data[index];
                const x = point.x;
                const y = point.y; // Centro do ponto
                
                const fontSize = 14;
                const padding = 5;
                canvasCtx.font = `bold ${fontSize}px Arial`;
                canvasCtx.textAlign = 'center';
                canvasCtx.textBaseline = 'middle'; // Centraliza verticalmente

                const textMetrics = canvasCtx.measureText(value);
                const textWidth = textMetrics.width;
                
                const boxWidth = textWidth + padding * 2;
                const boxHeight = fontSize + padding * 2;
                
                // Posição da caixa (acima do ponto)
                const boxX = x - boxWidth / 2;
                const boxY = y - boxHeight - 10; // 10px acima do centro do ponto
                const textY = boxY + boxHeight / 2; // Posição Y do texto (centro da caixa)

                // Desenha a caixa
                canvasCtx.fillStyle = dataset.borderColor; // Cor da linha do gráfico
                canvasCtx.beginPath();
                canvasCtx.roundRect(boxX, boxY, boxWidth, boxHeight, 6); // Raio de 6px
                canvasCtx.fill();

                // Desenha o texto
                canvasCtx.fillStyle = '#ffffff'; // Texto branco
                canvasCtx.fillText(value, x, textY);
              });
            });
          }
          // ========= Fim da Modificação do Datalabel =========
        }]
      });
    }

    // Adiciona cursor pointer nos gráficos
    document.querySelectorAll('canvas').forEach(canvas => {
      canvas.style.cursor = 'pointer';
    });

    // Adiciona listeners aos novos dropdowns
    document.getElementById('selectMes').addEventListener('change', updateTableFilters);
    document.getElementById('selectTipo').addEventListener('change', updateTableFilters);

    criarGraficoLinha('chartAdmissoes','Admissões',series['Admissões']);
    criarGraficoLinha('chartDemissoes','Demissões',series['Demissões']);
    criarGraficoLinha('chartFerias','Férias',series['Férias']);
    criarGraficoLinha('chartProLabores','Pró Labores',series['Pró Labores']);
    criarGraficoLinha('chartFolhas','Folhas de Pagamento',series['Folhas de Pagamento']);
    
  </script>
</body>
</html>